@entry_point("compile")
def compile_main(args) {
  def out_name := args[0];
  def binary := new Binary(new Ia386());

  def main := binary.add_code_block("_main");
  main.mov(10, rEax);
  main.call(CallTarget.local("foo"));
  
  def foo := binary.add_code_block("foo");
  foo.call(CallTarget.extern("_exit"));
  foo.int3();

  def data := binary.encode;
  open_file(out_name).write_binary(data);  
}
