@entry_point("compile")
def compile_main(args) {
  def out_name := args[0];
  def binary := new Binary(new Ia386());

  def main := binary.add_code_block("_main");
  main.push(rEbp);
  main.mov(rEsp, rEbp);
  main.sub(16r18, rEsp);
  main.mov(1, deref(rEsp));
  main.call(CallTarget.extern("_sleep$UNIX2003"));
  main.mov(10, deref(rEsp));
  main.call(CallTarget.extern("_exit"));
  main.leave();
  main.ret();
  
  def data := binary.encode;
  open_file(out_name).write_binary(data);  
}
